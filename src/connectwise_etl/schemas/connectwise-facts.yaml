# ConnectWise Gold Layer Fact Table Schemas - ULTRA CLEAN VERSION
# Only raw measures, no calculated bullshit, no business logic, no DAX pollution

facts:

  fact_time_entry:
    table_name: "gold.gold_cw_fact_timeentry"
    primary_key: "TimeentrySK"
    grain: "One row per time entry"
    description: "Raw time entry measures only - all calculations done in DAX"
    columns:
      # Primary Key
      - name: "TimeentrySK"
        type: "string"
        description: "SHA2 hash surrogate key"
      
      # Natural Key
      - name: "timeEntryId"
        type: "integer"
        description: "Original time entry ID from ConnectWise"
      
      # Foreign Key IDs (for dimension joins ONLY)
      - name: "memberId"
        type: "integer"
      - name: "agreementId"
        type: "integer" 
      - name: "chargeToId"
        type: "integer"
      - name: "invoiceId"
        type: "integer"
      - name: "invoiceNumber"
        type: "string"
        description: "Invoice identifier"
      - name: "ticketId"
        type: "integer"
      - name: "projectId"
        type: "integer"
      - name: "companyId"
        type: "integer"
      - name: "locationId"
        type: "integer"
      - name: "departmentId"
        type: "integer"
      - name: "businessUnitId"
        type: "integer"
      - name: "timeSheetId"
        type: "integer"
      - name: "workTypeId"
        type: "integer"
      - name: "workRoleId"
        type: "integer"
      
      # Time Dimensions
      - name: "timeStart"
        type: "timestamp"
        description: "When work started"
      - name: "timeEnd"
        type: "timestamp"
        description: "When work ended"
      - name: "dateEntered"
        type: "timestamp"
        description: "When entry was created"
      - name: "WorkDateSK"
        type: "integer"
        description: "Date dimension key for timeStart"
      
      # RAW Measures ONLY - no calculations
      - name: "actualHours"
        type: "decimal"
        description: "Hours actually worked - RAW from source"
      - name: "hoursDeduct"
        type: "decimal"
        description: "Hours deducted - RAW from source"
      - name: "hoursBilled"
        type: "decimal"
        description: "Hours billed to customer - RAW from source"
      - name: "invoiceHours"
        type: "decimal"
        description: "Hours on invoice - RAW from source"
      - name: "agreementHours"
        type: "decimal"
        description: "Hours counted against agreement - RAW from source"
      - name: "hourlyRate"
        type: "decimal"
        description: "Rate charged to customer - RAW from source"
      - name: "hourlyCost"
        type: "decimal"
        description: "Internal cost per hour - RAW from source"
      - name: "overageRate"
        type: "decimal"
        description: "Rate for overage hours - RAW from source"
      - name: "agreementAmount"
        type: "decimal"
        description: "Amount from agreement - RAW from source"
      
      # Essential Transaction Metadata
      - name: "notes"
        type: "string"
        description: "Public notes"
      - name: "internalNotes"
        type: "string"
        description: "Internal notes"
      - name: "enteredBy"
        type: "string"
        description: "Who created the entry"
      
      # Surrogate Keys for Dimension Joins
      - name: "BillableStatusKey"
        type: "bigint"
        description: "FK to dim_billable_status"
      - name: "TimeEntryStatusKey"
        type: "bigint"
        description: "FK to dim_time_entry_status"
      - name: "ChargeTypeKey"
        type: "bigint"
        description: "FK to dim_charge_type"
      - name: "WorkTypeKey"
        type: "bigint"
        description: "FK to dim_work_type"
      - name: "WorkRoleKey"
        type: "bigint"
        description: "FK to dim_work_role"
      - name: "DepartmentKey"
        type: "bigint"
        description: "FK to dim_department"
      - name: "BusinessUnitKey"
        type: "bigint"
        description: "FK to dim_business_unit"
      - name: "MemberKey"
        type: "bigint"
        description: "FK to dim_member"
      - name: "CompanyKey"
        type: "bigint"
        description: "FK to dim_company"
      - name: "AgreementTypeKey"
        type: "bigint"
        description: "FK to dim_agreement_type"

  fact_product_item:
    table_name: "gold.gold_cw_fact_productitem"
    primary_key: "ProductItemSK"
    grain: "One row per product line item"
    description: "Product sales and cost measures - focused on actual business usage"
    columns:
      # Primary Key
      - name: "ProductItemSK"
        type: "string"
        description: "SHA2 hash surrogate key"
      
      # Natural Key
      - name: "productItemId"
        type: "integer"
        description: "Original product item ID from ConnectWise"
      
      # Foreign Key IDs (for dimension joins ONLY)
      - name: "catalogItemId"
        type: "integer"
        description: "Catalog item identifier"
      - name: "companyId"
        type: "integer"
        description: "Company identifier"
      - name: "agreementId"
        type: "integer"
        description: "Agreement identifier"
      - name: "invoiceId"
        type: "integer"
        description: "Invoice identifier"
      
      # RAW Measures (what Power BI actually uses)
      - name: "quantity"
        type: "decimal"
        description: "Item quantity - RAW from source"
      - name: "quantityCancelled"
        type: "decimal"
        description: "Cancelled quantity - RAW from source"
      - name: "price"
        type: "decimal"
        description: "Unit price - RAW from source"
      - name: "cost"
        type: "decimal"
        description: "Unit cost - RAW from source"
      - name: "calculatedPrice"
        type: "decimal"
        description: "Calculated unit price - RAW from source"
      - name: "calculatedCost"
        type: "decimal"
        description: "Calculated unit cost - RAW from source"
      - name: "extPrice"
        type: "decimal"
        description: "Extended price - RAW from source"
      - name: "extCost"
        type: "decimal"
        description: "Extended cost - RAW from source"
      - name: "discount"
        type: "decimal"
        description: "Discount amount - RAW from source"
      - name: "agreementAmount"
        type: "decimal"
        description: "Agreement amount - RAW from source"
      
      # Essential Classification
      - name: "billableOption"
        type: "string"
        description: "Billable/DoNotBill/NoCharge"
      
      # Surrogate Keys for Dimension Joins
      - name: "CompanyKey"
        type: "bigint"
        description: "FK to dim_company"
      - name: "BillableStatusKey"
        type: "bigint"
        description: "FK to dim_billable_status"